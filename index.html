<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„ - ã‚¢ã‚µãƒãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }
    
    body {
      background: #F8FAFB;
    }
    
    .step-indicator {
      position: relative;
    }
    
    .step-indicator::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 100%;
      width: 100%;
      height: 2px;
      background: #E5E7EB;
      transform: translateY(-50%);
      z-index: -1;
    }
    
    .step-indicator.active::after {
      background: #3B82F6;
    }
    
    .step-indicator:last-child::after {
      display: none;
    }
    
    .calendar-cell {
      aspect-ratio: 1;
      transition: all 0.2s;
    }
    
    .calendar-cell:hover:not(.disabled):not(.past) {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }
    
    .time-slot {
      transition: all 0.2s;
    }
    
    .time-slot:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .lesson-card {
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .lesson-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3B82F6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
  </style>
</head>
<body>
  
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="bg-white border-b border-gray-200 py-4 md:py-6">
    <div class="max-w-5xl mx-auto px-3 md:px-4 flex justify-between items-center">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900">ã‚¢ã‚µãƒãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«</h1>
        <p class="text-sm md:text-base text-gray-600 mt-1">ãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„</p>
      </div>
      <button onclick="location.reload()" class="text-sm text-gray-600 hover:text-blue-600 flex items-center space-x-1">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        <span class="hidden md:inline">ãƒˆãƒƒãƒ—ã¸</span>
      </button>
    </div>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="max-w-5xl mx-auto px-3 md:px-4 py-4 md:py-8">
    
    <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div class="mb-6 md:mb-8">
      <div class="flex items-center justify-between max-w-3xl mx-auto">
        <div id="step1-indicator" class="step-indicator active flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base">1</div>
          <span class="text-xs md:text-sm font-medium text-gray-900">ãƒ¬ãƒƒã‚¹ãƒ³</span>
        </div>
        <div id="step2-indicator" class="step-indicator flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base">2</div>
          <span class="text-xs md:text-sm font-medium text-gray-500">ã‚¹ã‚¿ãƒƒãƒ•</span>
        </div>
        <div id="step3-indicator" class="step-indicator flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base">3</div>
          <span class="text-xs md:text-sm font-medium text-gray-500">æ—¥æ™‚</span>
        </div>
        <div id="step4-indicator" class="step-indicator flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base">4</div>
          <span class="text-xs md:text-sm font-medium text-gray-500">æƒ…å ±</span>
        </div>
        <div id="step5-indicator" class="step-indicator flex flex-col items-center flex-1">
          <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base">5</div>
          <span class="text-xs md:text-sm font-medium text-gray-500">ç¢ºèª</span>
        </div>
      </div>
    </div>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 md:p-8">
      
      <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠ -->
      <div id="step1" class="step-content fade-in">
        <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4 md:mb-6">ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <label class="lesson-card">
            <input type="radio" name="lessonType" value="ç„¡æ–™ä½“é¨“" class="peer hidden">
            <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <div class="flex justify-between items-start mb-2 md:mb-3">
                <div>
                  <h3 class="text-base md:text-lg font-bold text-gray-900">ç„¡æ–™ä½“é¨“ãƒ¬ãƒƒã‚¹ãƒ³</h3>
                  <p class="text-xs md:text-sm text-gray-600 mt-1">åˆã‚ã¦ã®æ–¹ã«ãŠã™ã™ã‚</p>
                </div>
                <div class="text-xl md:text-2xl font-bold text-blue-600">ç„¡æ–™</div>
              </div>
              <div class="text-xs md:text-sm text-gray-600">
                <p>â± 60åˆ†</p>
              </div>
            </div>
          </label>

          <label class="lesson-card">
            <input type="radio" name="lessonType" value="ã‚°ãƒ«ãƒ¼ãƒ—" class="peer hidden">
            <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <div class="flex justify-between items-start mb-2 md:mb-3">
                <div>
                  <h3 class="text-base md:text-lg font-bold text-gray-900">ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¬ãƒƒã‚¹ãƒ³</h3>
                  <p class="text-xs md:text-sm text-gray-600 mt-1">ä»²é–“ã¨ä¸€ç·’ã«æ¥½ã—ã</p>
                </div>
                <div class="text-xl md:text-2xl font-bold text-blue-600">Â¥3,000</div>
              </div>
              <div class="text-xs md:text-sm text-gray-600">
                <p>â± 60åˆ†</p>
              </div>
            </div>
          </label>

          <label class="lesson-card">
            <input type="radio" name="lessonType" value="å€‹äºº" class="peer hidden">
            <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <div class="flex justify-between items-start mb-2 md:mb-3">
                <div>
                  <h3 class="text-base md:text-lg font-bold text-gray-900">å€‹äººãƒ¬ãƒƒã‚¹ãƒ³</h3>
                  <p class="text-xs md:text-sm text-gray-600 mt-1">ãƒãƒ³ãƒ„ãƒ¼ãƒãƒ³ã§ä¸å¯§ã«</p>
                </div>
                <div class="text-xl md:text-2xl font-bold text-blue-600">Â¥8,000</div>
              </div>
              <div class="text-xs md:text-sm text-gray-600">
                <p>â± 60åˆ†</p>
              </div>
            </div>
          </label>

          <label class="lesson-card">
            <input type="radio" name="lessonType" value="ã‚«ãƒƒãƒ—ãƒ«" class="peer hidden">
            <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <div class="flex justify-between items-start mb-2 md:mb-3">
                <div>
                  <h3 class="text-base md:text-lg font-bold text-gray-900">ã‚«ãƒƒãƒ—ãƒ«ãƒ¬ãƒƒã‚¹ãƒ³</h3>
                  <p class="text-xs md:text-sm text-gray-600 mt-1">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ä¸€ç·’ã«</p>
                </div>
                <div class="text-xl md:text-2xl font-bold text-blue-600">Â¥12,000</div>
              </div>
              <div class="text-xs md:text-sm text-gray-600">
                <p>â± 60åˆ†</p>
              </div>
            </div>
          </label>
        </div>

        <div class="mt-6 md:mt-8 flex justify-end">
          <button onclick="goToStep(2)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            æ¬¡ã¸ â†’
          </button>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¹ã‚¿ãƒƒãƒ•é¸æŠ -->
      <div id="step2" class="step-content hidden">
        <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4 md:mb-6">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        
        <div id="staffSelection" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- ã‚¹ã‚¿ãƒƒãƒ•ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
          <p class="text-gray-500 text-center py-8 col-span-2">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <!-- ãŠã¾ã‹ã›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
        <div class="mt-6">
          <label class="lesson-card cursor-pointer">
            <input type="radio" name="staffSelect" value="any" class="peer hidden">
            <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
              <div class="flex items-center space-x-3">
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-gray-200 flex items-center justify-center text-2xl">
                  âœ¨
                </div>
                <div>
                  <h3 class="text-base md:text-lg font-bold text-gray-900">ãŠã¾ã‹ã›</h3>
                  <p class="text-xs md:text-sm text-gray-600 mt-1">ã‚¹ã‚¿ãƒƒãƒ•ã¯æŒ‡åã—ãªã„</p>
                </div>
              </div>
            </div>
          </label>
        </div>

        <div class="mt-6 md:mt-8 flex justify-between">
          <button onclick="goToStep(1)" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            â† æˆ»ã‚‹
          </button>
          <button onclick="goToStep(3)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            æ¬¡ã¸ â†’
          </button>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—3: æ—¥æ™‚é¸æŠ -->
      <div id="step3" class="step-content hidden">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="flex justify-between items-center mb-6">
          <button onclick="prevMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <h3 id="calendarTitle" class="text-xl font-bold text-gray-900"></h3>
          <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ -->
        <div id="calendarGrid" class="mb-8"></div>

        <!-- æ™‚é–“é¸æŠ -->
        <div id="timeSelection" class="hidden">
          <h3 class="text-lg font-bold text-gray-900 mb-4">æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
          <div id="timeSlots" class="grid grid-cols-4 md:grid-cols-6 gap-3"></div>
        </div>

        <div class="mt-6 md:mt-8 flex justify-between">
          <button onclick="goToStep(2)" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            â† æˆ»ã‚‹
          </button>
          <button id="step3Next" onclick="goToStep(4)" disabled class="bg-gray-300 text-gray-500 px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold cursor-not-allowed text-sm md:text-base">
            æ¬¡ã¸ â†’
          </button>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ãŠå®¢æ§˜æƒ…å ± -->
      <div id="step4" class="step-content hidden">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">ãŠå®¢æ§˜æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
        
        <div class="space-y-6">
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">ãŠåå‰ <span class="text-red-500">*</span></label>
            <input type="text" id="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="å±±ç”° å¤ªéƒ">
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">é›»è©±ç•ªå· <span class="text-red-500">*</span></label>
              <input type="tel" id="phone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="090-1234-5678">
            </div>
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
              <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="example@email.com">
            </div>
          </div>

          <div>
            <label class="block text-sm font-bold text-gray-700 mb-3">ãƒ€ãƒ³ã‚¹çµŒé¨“ <span class="text-red-500">*</span></label>
            <div class="grid grid-cols-3 gap-3">
              <label class="cursor-pointer">
                <input type="radio" name="experience" value="æœªçµŒé¨“" required class="peer hidden">
                <div class="border-2 border-gray-200 rounded-lg p-4 text-center peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
                  <div class="font-bold">æœªçµŒé¨“</div>
                </div>
              </label>
              <label class="cursor-pointer">
                <input type="radio" name="experience" value="çµŒé¨“ã‚ã‚Š" class="peer hidden">
                <div class="border-2 border-gray-200 rounded-lg p-4 text-center peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
                  <div class="font-bold">çµŒé¨“ã‚ã‚Š</div>
                </div>
              </label>
              <label class="cursor-pointer">
                <input type="radio" name="experience" value="ä¸Šç´š" class="peer hidden">
                <div class="border-2 border-gray-200 rounded-lg p-4 text-center peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
                  <div class="font-bold">ä¸Šç´š</div>
                </div>
              </label>
            </div>
          </div>

          <div>
            <label class="block text-sm font-bold text-gray-700 mb-3">ãŠæ”¯æ‰•ã„æ–¹æ³• <span class="text-red-500">*</span></label>
            <div class="grid grid-cols-2 gap-4">
              <label class="cursor-pointer">
                <input type="radio" name="payment" value="ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ" required class="peer hidden">
                <div class="border-2 border-gray-200 rounded-lg p-4 text-center peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
                  <div class="text-3xl mb-2">ğŸ’³</div>
                  <div class="font-bold">ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ</div>
                  <div class="text-xs text-gray-600 mt-1">äº‹å‰æ±ºæ¸ˆ</div>
                </div>
              </label>
              <label class="cursor-pointer">
                <input type="radio" name="payment" value="ç¾åœ°æ±ºæ¸ˆ" class="peer hidden">
                <div class="border-2 border-gray-200 rounded-lg p-4 text-center peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
                  <div class="text-3xl mb-2">ğŸ¢</div>
                  <div class="font-bold">ç¾åœ°æ±ºæ¸ˆ</div>
                  <div class="text-xs text-gray-600 mt-1">ã‚¹ã‚¿ã‚¸ã‚ªæ‰•ã„</div>
                </div>
              </label>
            </div>
          </div>

          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">ã”è¦æœ›ãƒ»ã”è³ªå•</label>
            <textarea id="message" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none" placeholder="æ°—ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Œã°ãŠæ°—è»½ã«ãŠæ›¸ããã ã•ã„"></textarea>
          </div>
        </div>

        <div class="mt-6 md:mt-8 flex justify-between">
          <button onclick="goToStep(3)" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            â† æˆ»ã‚‹
          </button>
          <button onclick="goToStep(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            æ¬¡ã¸ â†’
          </button>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—5: ç¢ºèª -->
      <div id="step5" class="step-content hidden">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">äºˆç´„å†…å®¹ã®ç¢ºèª</h2>
        
        <div id="confirmationContent" class="bg-gray-50 rounded-lg p-6 space-y-4 mb-8"></div>

        <div class="mt-6 md:mt-8 flex justify-between">
          <button onclick="goToStep(3)" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            â† æˆ»ã‚‹
          </button>
          <button onclick="submitBooking()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 md:px-12 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base">
            äºˆç´„ã‚’ç¢ºå®šã™ã‚‹
          </button>
        </div>
      </div>

    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div class="text-center mt-8">
      <a href="admin-login.html" class="text-sm text-gray-500 hover:text-blue-600 transition">ç®¡ç†è€…ã®æ–¹ã¯ã“ã¡ã‚‰</a>
    </div>

  </div>

  <script type="module">
    // Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDbcAHRmhBGfUoqpf-LzgyrPdSRmGeJtDU",
      authDomain: "asano-dance-school-8b670.firebaseapp.com",
      projectId: "asano-dance-school-8b670",
      storageBucket: "asano-dance-school-8b670.firebasestorage.app",
      messagingSenderId: "167959563019",
      appId: "1:167959563019:web:840229f09cbcf86ae3300e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // å¤‰æ•°
    let currentStep = 1;
    let bookingData = {};
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;

    // ã‚¹ãƒ†ãƒƒãƒ—ç®¡ç†
    window.goToStep = function(step) {
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (step === 2 && !validateStep1()) return;
      // ã‚¹ã‚¿ãƒƒãƒ•é¸æŠã¯ä»»æ„ãªã®ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—
      if (step === 4 && !validateStep3()) return;
      if (step === 5 && !validateStep4()) return;

      // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
      if (step === 2) saveStep1();
      if (step === 3) {
        const staff = document.querySelector('input[name="staffSelect"]:checked');
        selectedStaff = staff ? staff.value : null;
      }
      if (step === 4) saveStep3();
      if (step === 5) saveStep4();

      // UIæ›´æ–°
      document.getElementById(`step${currentStep}`).classList.add('hidden');
      document.getElementById(`step${step}`).classList.remove('hidden');
      document.getElementById(`step${step}`).classList.add('fade-in');

      updateStepIndicators(step);

      if (step === 2 && currentStep === 1) loadStaffList();
      if (step === 3 && currentStep === 2) renderCalendar();
      if (step === 5) showConfirmation();

      currentStep = step;
      window.scrollTo(0, 0);
    };

    function updateStepIndicators(step) {
      for (let i = 1; i <= 5; i++) {
        const indicator = document.getElementById(`step${i}-indicator`);
        const circle = indicator.querySelector('div');
        const text = indicator.querySelector('span');
        
        if (i < step) {
          circle.className = 'w-8 h-8 md:w-10 md:h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base';
          circle.textContent = 'âœ“';
          text.className = 'text-xs md:text-sm font-medium text-green-600';
          indicator.classList.add('active');
        } else if (i === step) {
          circle.className = 'w-8 h-8 md:w-10 md:h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base';
          circle.textContent = i;
          text.className = 'text-xs md:text-sm font-medium text-gray-900';
          indicator.classList.add('active');
        } else {
          circle.className = 'w-8 h-8 md:w-10 md:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-1 md:mb-2 text-sm md:text-base';
          circle.textContent = i;
          text.className = 'text-xs md:text-sm font-medium text-gray-500';
          indicator.classList.remove('active');
        }
      }
    }

    function validateStep2() {
      return true; // ã‚¹ã‚¿ãƒƒãƒ•é¸æŠã¯å¿…é ˆã§ã¯ãªã„
    }

    function validateStep3() {
      if (!selectedDate || !selectedTime) {
        alert('æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return false;
      }
      return true;
    }

    function validateStep4() {
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const experience = document.querySelector('input[name="experience"]:checked');
      const payment = document.querySelector('input[name="payment"]:checked');

      if (!name || !phone || !experience || !payment) {
        alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return false;
      }
      return true;
    }

    // ã‚¹ã‚¿ãƒƒãƒ•ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
    async function loadStaffList() {
      try {
        const staffQuery = query(collection(db, 'staff'));
        const querySnapshot = await getDocs(staffQuery);
        
        allStaff = [];
        querySnapshot.forEach((doc) => {
          allStaff.push({ id: doc.id, ...doc.data() });
        });

        let html = '';
        allStaff.forEach(staff => {
          html += `
            <label class="lesson-card cursor-pointer">
              <input type="radio" name="staffSelect" value="${staff.id}" class="peer hidden">
              <div class="border-2 border-gray-200 rounded-lg p-4 md:p-6 peer-checked:border-blue-500 peer-checked:bg-blue-50">
                <div class="flex items-center space-x-3">
                  ${staff.photo ? `
                    <img src="${staff.photo}" alt="${staff.name}" class="w-12 h-12 md:w-16 md:h-16 rounded-full object-cover">
                  ` : `
                    <div class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-gray-200 flex items-center justify-center text-xl md:text-2xl font-bold">
                      ${staff.name.charAt(0)}
                    </div>
                  `}
                  <div class="flex-1">
                    <h3 class="text-base md:text-lg font-bold text-gray-900">${staff.name}</h3>
                    <p class="text-xs md:text-sm text-gray-600 mt-1">${staff.specialty.join('ãƒ»')}</p>
                  </div>
                </div>
              </div>
            </label>
          `;
        });

        document.getElementById('staffSelection').innerHTML = html || '<p class="text-gray-500 text-center py-8 col-span-2">ã‚¹ã‚¿ãƒƒãƒ•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
        
      } catch (error) {
        console.error('ã‚¹ã‚¿ãƒƒãƒ•èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('staffSelection').innerHTML = '<p class="text-gray-500 text-center py-8 col-span-2">ã‚¹ã‚¿ãƒƒãƒ•ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateStep1() {
      const lesson = document.querySelector('input[name="lessonType"]:checked');
      if (!lesson) {
        alert('ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return false;
      }
      return true;
    }

    function validateStep2() {
    // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    function saveStep1() {
      bookingData.lessonType = document.querySelector('input[name="lessonType"]:checked').value;
    }

    function saveStep3() {
      bookingData.date = selectedDate;
      bookingData.time = selectedTime;
    }

    function saveStep4() {
      bookingData.name = document.getElementById('name').value;
      bookingData.phone = document.getElementById('phone').value;
      bookingData.email = document.getElementById('email').value || '';
      bookingData.experience = document.querySelector('input[name="experience"]:checked').value;
      bookingData.payment = document.querySelector('input[name="payment"]:checked').value;
      bookingData.message = document.getElementById('message').value || '';
      
      // ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’è¿½åŠ 
      if (selectedStaff && selectedStaff !== 'any') {
        const staff = allStaff.find(s => s.id === selectedStaff);
        if (staff) {
          bookingData.staffId = selectedStaff;
          bookingData.staffName = staff.name;
        }
      }
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    window.prevMonth = function() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    };

    window.nextMonth = function() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    };

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      document.getElementById('calendarTitle').textContent = `${year}å¹´${month + 1}æœˆ`;
      
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      let html = '<div class="grid grid-cols-7 gap-2">';
      
      // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
      const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      dayNames.forEach((day, i) => {
        const color = i === 0 ? 'text-red-600' : i === 6 ? 'text-blue-600' : 'text-gray-600';
        html += `<div class="text-center font-bold ${color} py-2 text-sm">${day}</div>`;
      });
      
      // ç©ºç™½ã‚»ãƒ«
      for (let i = 0; i < firstDay; i++) {
        html += '<div></div>';
      }
      
      // æ—¥ä»˜ã‚»ãƒ«
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = date.toISOString().split('T')[0];
        const isPast = date < today;
        const isSelected = selectedDate === dateStr;
        const dayOfWeek = date.getDay();
        
        let classes = 'calendar-cell flex items-center justify-center border-2 rounded-lg font-bold cursor-pointer ';
        
        if (isPast) {
          classes += 'bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed past';
        } else if (isSelected) {
          classes += 'bg-blue-500 border-blue-500 text-white';
        } else {
          classes += 'bg-white border-gray-200 hover:border-blue-400 text-gray-900';
        }
        
        const onclick = isPast ? '' : `onclick="selectDate('${dateStr}')"`;
        
        html += `<div ${onclick} class="${classes}">${day}</div>`;
      }
      
      html += '</div>';
      document.getElementById('calendarGrid').innerHTML = html;
    }

    window.selectDate = function(dateStr) {
      selectedDate = dateStr;
      selectedTime = null;
      renderCalendar();
      showTimeSlots();
    };

    function showTimeSlots() {
      const times = ['10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'];
      
      let html = '';
      times.forEach(time => {
        const selected = selectedTime === time;
        const classes = selected 
          ? 'time-slot bg-blue-500 text-white border-2 border-blue-500 px-4 py-3 rounded-lg font-bold'
          : 'time-slot bg-white text-gray-900 border-2 border-gray-200 hover:border-blue-400 px-4 py-3 rounded-lg font-bold';
        
        html += `<button type="button" onclick="selectTime('${time}')" class="${classes}">${time}</button>`;
      });
      
      document.getElementById('timeSlots').innerHTML = html;
      document.getElementById('timeSelection').classList.remove('hidden');
      
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      setTimeout(() => {
        document.getElementById('timeSelection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    window.selectTime = function(time) {
      selectedTime = time;
      showTimeSlots();
      
      // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
      const btn = document.getElementById('step3Next');
      btn.disabled = false;
      btn.className = 'bg-blue-500 hover:bg-blue-600 text-white px-6 md:px-8 py-2.5 md:py-3 rounded-lg font-bold transition text-sm md:text-base';
    };

    // ç¢ºèªç”»é¢
    function showConfirmation() {
      const priceMap = {
        'ç„¡æ–™ä½“é¨“': 'ç„¡æ–™',
        'ã‚°ãƒ«ãƒ¼ãƒ—': 'Â¥3,000',
        'å€‹äºº': 'Â¥8,000',
        'ã‚«ãƒƒãƒ—ãƒ«': 'Â¥12,000'
      };

      const html = `
        <div class="space-y-3">
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">ãƒ¬ãƒƒã‚¹ãƒ³</span>
            <span class="font-bold text-gray-900">${bookingData.lessonType}</span>
          </div>
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">æ–™é‡‘</span>
            <span class="font-bold text-blue-600 text-xl">${priceMap[bookingData.lessonType]}</span>
          </div>
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">æ—¥æ™‚</span>
            <span class="font-bold text-gray-900">${bookingData.date} ${bookingData.time}</span>
          </div>
          ${bookingData.staffName ? `
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•</span>
            <span class="font-bold text-gray-900">${bookingData.staffName}</span>
          </div>
          ` : ''}
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">ãŠåå‰</span>
            <span class="font-bold text-gray-900">${bookingData.name}</span>
          </div>
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">é›»è©±ç•ªå·</span>
            <span class="font-bold text-gray-900">${bookingData.phone}</span>
          </div>
          ${bookingData.email ? `
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">ãƒ¡ãƒ¼ãƒ«</span>
            <span class="font-bold text-gray-900">${bookingData.email}</span>
          </div>
          ` : ''}
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">ãƒ€ãƒ³ã‚¹çµŒé¨“</span>
            <span class="font-bold text-gray-900">${bookingData.experience}</span>
          </div>
          <div class="flex justify-between py-3 border-b">
            <span class="text-gray-600">ãŠæ”¯æ‰•ã„æ–¹æ³•</span>
            <span class="font-bold text-gray-900">${bookingData.payment}</span>
          </div>
          ${bookingData.message ? `
          <div class="py-3">
            <div class="text-gray-600 mb-2">ã”è¦æœ›</div>
            <div class="bg-white p-4 rounded-lg border border-gray-200 text-gray-900">${bookingData.message}</div>
          </div>
          ` : ''}
        </div>
      `;

      document.getElementById('confirmationContent').innerHTML = html;
    }

    // äºˆç´„é€ä¿¡
    window.submitBooking = async function() {
      try {
        const data = {
          ...bookingData,
          createdAt: new Date().toISOString(),
          status: 'confirmed'
        };

        await addDoc(collection(db, 'bookings'), data);
        
        alert('ğŸ‰ äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nç¢ºèªã®ã”é€£çµ¡ã‚’å·®ã—ä¸Šã’ã¾ã™ã®ã§ã€å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚');
        location.reload();
        
      } catch (error) {
        console.error('äºˆç´„ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ äºˆç´„ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nãŠæ‰‹æ•°ã§ã™ãŒã€ãŠé›»è©±ã«ã¦ã”äºˆç´„ãã ã•ã„ã€‚');
      }
    };
  </script>

</body>
</html>
