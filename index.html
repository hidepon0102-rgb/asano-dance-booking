<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¢ã‚µãƒãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen p-4">
    <div class="max-w-md mx-auto">
      <div class="text-center pt-6 pb-4">
        <h1 class="text-2xl font-bold mb-1">ãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„</h1>
        <p class="text-sm text-gray-600">ã‚¢ã‚µãƒãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«</p>
        <div id="connectionStatus" class="mt-2 text-xs bg-yellow-100 text-yellow-800 py-2 px-4 rounded">
          ğŸ”„ Firebaseæ¥ç¶šä¸­...
        </div>
      </div>

      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-bold mb-4">äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h2>
        
        <form id="bookingForm" class="space-y-4">
          <div>
            <label class="block text-sm font-semibold mb-2">ãŠåå‰ *</label>
            <input type="text" id="name" required class="w-full p-2 border-2 rounded" placeholder="å±±ç”° å¤ªéƒ">
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">é›»è©±ç•ªå· *</label>
            <input type="tel" id="phone" required class="w-full p-2 border-2 rounded" placeholder="090-1234-5678">
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" id="email" class="w-full p-2 border-2 rounded" placeholder="example@email.com">
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">å¸Œæœ›æ—¥ *</label>
            <input type="date" id="date" required class="w-full p-2 border-2 rounded">
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">å¸Œæœ›æ™‚é–“ *</label>
            <select id="time" required class="w-full p-2 border-2 rounded">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
              <option value="14:00">14:00</option>
              <option value="15:00">15:00</option>
              <option value="16:00">16:00</option>
              <option value="17:00">17:00</option>
              <option value="18:00">18:00</option>
              <option value="19:00">19:00</option>
              <option value="20:00">20:00</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">ãƒ¬ãƒƒã‚¹ãƒ³ç¨®é¡ *</label>
            <select id="lessonType" required class="w-full p-2 border-2 rounded">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="ç„¡æ–™ä½“é¨“">ç„¡æ–™ä½“é¨“ãƒ¬ãƒƒã‚¹ãƒ³</option>
              <option value="ã‚°ãƒ«ãƒ¼ãƒ—">ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¬ãƒƒã‚¹ãƒ³</option>
              <option value="å€‹äºº">å€‹äººãƒ¬ãƒƒã‚¹ãƒ³</option>
              <option value="ã‚«ãƒƒãƒ—ãƒ«">ã‚«ãƒƒãƒ—ãƒ«ãƒ¬ãƒƒã‚¹ãƒ³</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">ã”è¦æœ›</label>
            <textarea id="message" rows="3" class="w-full p-2 border-2 rounded resize-none" placeholder="æ°—ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Œã°ãŠæ›¸ããã ã•ã„"></textarea>
          </div>

          <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded font-semibold hover:bg-blue-700">
            äºˆç´„ã‚’é€ä¿¡
          </button>
        </form>

        <div class="mt-6 pt-6 border-t">
          <button id="viewBookingsBtn" class="w-full bg-gray-100 text-gray-700 py-2 rounded hover:bg-gray-200">
            äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤º
          </button>
        </div>
      </div>

      <div id="bookingsList" class="mt-4 hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-bold mb-4">äºˆç´„ä¸€è¦§</h2>
          <div id="bookingsContent"></div>
          <button id="hideBookingsBtn" class="mt-4 w-full bg-gray-100 py-2 rounded">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase SDKã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyDbcAHRmhBGfUoqpf-LzgyrPdSRmGeJtDU",
      authDomain: "asano-dance-school-8b670.firebaseapp.com",
      projectId: "asano-dance-school-8b670",
      storageBucket: "asano-dance-school-8b670.firebasestorage.app",
      messagingSenderId: "167959563019",
      appId: "1:167959563019:web:840229f09cbcf86ae3300e"
    };

    // Firebaseã®åˆæœŸåŒ–
    let app, db;
    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      
      // æ¥ç¶šæˆåŠŸè¡¨ç¤º
      document.getElementById('connectionStatus').className = 'mt-2 text-xs bg-green-100 text-green-800 py-2 px-4 rounded';
      document.getElementById('connectionStatus').textContent = 'ğŸ”¥ Firebaseæ¥ç¶šæ¸ˆã¿ - ãƒ‡ãƒ¼ã‚¿ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ã•ã‚Œã¾ã™';
      
      console.log('âœ… Firebaseæ¥ç¶šæˆåŠŸï¼');
    } catch (error) {
      console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      document.getElementById('connectionStatus').className = 'mt-2 text-xs bg-red-100 text-red-800 py-2 px-4 rounded';
      document.getElementById('connectionStatus').textContent = 'âŒ Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼';
    }

    // äºˆç´„é€ä¿¡
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'é€ä¿¡ä¸­...';
      
      const bookingData = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value || '',
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        lessonType: document.getElementById('lessonType').value,
        message: document.getElementById('message').value || '',
        createdAt: new Date().toISOString(),
        status: 'confirmed'
      };

      try {
        const docRef = await addDoc(collection(db, 'bookings'), bookingData);
        console.log('äºˆç´„ID:', docRef.id);
        
        alert('âœ… äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nFirebaseã«ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
        document.getElementById('bookingForm').reset();
      } catch (error) {
        console.error('äºˆç´„ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ äºˆç´„ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'äºˆç´„ã‚’é€ä¿¡';
      }
    });

    // äºˆç´„ä¸€è¦§è¡¨ç¤º
    document.getElementById('viewBookingsBtn').addEventListener('click', async () => {
      try {
        const bookingsQuery = query(collection(db, 'bookings'));
        const querySnapshot = await getDocs(bookingsQuery);
        
        let html = '';
        if (querySnapshot.empty) {
          html = '<p class="text-gray-500 text-center py-4">äºˆç´„ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        } else {
          const bookings = [];
          querySnapshot.forEach((doc) => {
            bookings.push({ id: doc.id, ...doc.data() });
          });
          
          // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
          bookings.sort((a, b) => {
            const dateA = new Date(a.date + ' ' + a.time);
            const dateB = new Date(b.date + ' ' + b.time);
            return dateA - dateB;
          });
          
          bookings.forEach((booking) => {
            html += `
              <div class="border rounded p-4 mb-3">
                <div class="font-bold">${booking.name}</div>
                <div class="text-sm text-gray-600 mt-2 space-y-1">
                  <div>ğŸ“… ${booking.date} ${booking.time}</div>
                  <div>ğŸ“š ${booking.lessonType}</div>
                  <div>ğŸ“ ${booking.phone}</div>
                  ${booking.email ? `<div>ğŸ“§ ${booking.email}</div>` : ''}
                  ${booking.message ? `<div class="mt-2 p-2 bg-yellow-50 rounded">ğŸ’¬ ${booking.message}</div>` : ''}
                </div>
              </div>
            `;
          });
        }
        
        document.getElementById('bookingsContent').innerHTML = html;
        document.getElementById('bookingsList').classList.remove('hidden');
      } catch (error) {
        console.error('äºˆç´„å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ äºˆç´„ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    });

    // ä¸€è¦§ã‚’é–‰ã˜ã‚‹
    document.getElementById('hideBookingsBtn').addEventListener('click', () => {
      document.getElementById('bookingsList').classList.add('hidden');
    });

    // æ—¥ä»˜ã®æœ€å°å€¤ã‚’ä»Šæ—¥ã«è¨­å®š
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').setAttribute('min', today);
  </script>
</body>
</html>
